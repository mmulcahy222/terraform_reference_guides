{"azurerm-site-recovery-replicated-vm": "<h1 id=\"azurerm_site_recovery_replicated_vm\">azurerm_site_recovery_replicated_vm</h1><p>Manages a VM replicated using Azure Site Recovery (Azure to Azure only). A replicated VM keeps a copiously updated image of the VM in another region in order to be able to start the VM in that region in case of a disaster.</p>", "example-usage": "<h2 id=\"example-usage\">Example Usage</h2><p><br />resource \"azurerm_resource_group\" \"primary\" {<br />  name     = \"tfex-replicated-vm-primary\"<br />  location = \"West US\"<br />}</p><p>resource \"azurerm_resource_group\" \"secondary\" {<br />  name     = \"tfex-replicated-vm-secondary\"<br />  location = \"East US\"<br />}</p><p>resource \"azurerm_virtual_machine\" \"vm\" {<br />  name                  = \"vm\"<br />  location              = azurerm_resource_group.primary.location<br />  resource_group_name   = azurerm_resource_group.primary.name<br />  vm_size               = \"Standard_B1s\"<br />  network_interface_ids = [azurerm_network_interface.vm.id]</p><p>storage_image_reference {<br />    publisher = \"OpenLogic\"<br />    offer     = \"CentOS\"<br />    sku       = \"7.5\"<br />    version   = \"latest\"<br />  }</p><p>storage_os_disk {<br />    name              = \"vm-os-disk\"<br />    os_type           = \"Linux\"<br />    caching           = \"ReadWrite\"<br />    create_option     = \"FromImage\"<br />    managed_disk_type = \"Premium_LRS\"<br />  }</p><p>os_profile {<br />    admin_username = \"test-admin-123\"<br />    admin_password = \"test-pwd-123\"<br />    computer_name  = \"vm\"<br />  }</p><p>os_profile_linux_config {<br />    disable_password_authentication = false<br />  }<br />}</p><p>resource \"azurerm_recovery_services_vault\" \"vault\" {<br />  name                = \"example-recovery-vault\"<br />  location            = azurerm_resource_group.secondary.location<br />  resource_group_name = azurerm_resource_group.secondary.name<br />  sku                 = \"Standard\"<br />}</p><p>resource \"azurerm_site_recovery_fabric\" \"primary\" {<br />  name                = \"primary-fabric\"<br />  resource_group_name = azurerm_resource_group.secondary.name<br />  recovery_vault_name = azurerm_recovery_services_vault.vault.name<br />  location            = azurerm_resource_group.primary.location<br />}</p><p>resource \"azurerm_site_recovery_fabric\" \"secondary\" {<br />  name                = \"secondary-fabric\"<br />  resource_group_name = azurerm_resource_group.secondary.name<br />  recovery_vault_name = azurerm_recovery_services_vault.vault.name<br />  location            = azurerm_resource_group.secondary.location<br />}</p><p>resource \"azurerm_site_recovery_protection_container\" \"primary\" {<br />  name                 = \"primary-protection-container\"<br />  resource_group_name  = azurerm_resource_group.secondary.name<br />  recovery_vault_name  = azurerm_recovery_services_vault.vault.name<br />  recovery_fabric_name = azurerm_site_recovery_fabric.primary.name<br />}</p><p>resource \"azurerm_site_recovery_protection_container\" \"secondary\" {<br />  name                 = \"secondary-protection-container\"<br />  resource_group_name  = azurerm_resource_group.secondary.name<br />  recovery_vault_name  = azurerm_recovery_services_vault.vault.name<br />  recovery_fabric_name = azurerm_site_recovery_fabric.secondary.name<br />}</p><p>resource \"azurerm_site_recovery_replication_policy\" \"policy\" {<br />  name                                                 = \"policy\"<br />  resource_group_name                                  = azurerm_resource_group.secondary.name<br />  recovery_vault_name                                  = azurerm_recovery_services_vault.vault.name<br />  recovery_point_retention_in_minutes                  = 24 * 60<br />  application_consistent_snapshot_frequency_in_minutes = 4 * 60<br />}</p><p>resource \"azurerm_site_recovery_protection_container_mapping\" \"container-mapping\" {<br />  name                                      = \"container-mapping\"<br />  resource_group_name                       = azurerm_resource_group.secondary.name<br />  recovery_vault_name                       = azurerm_recovery_services_vault.vault.name<br />  recovery_fabric_name                      = azurerm_site_recovery_fabric.primary.name<br />  recovery_source_protection_container_name = azurerm_site_recovery_protection_container.primary.name<br />  recovery_target_protection_container_id   = azurerm_site_recovery_protection_container.secondary.id<br />  recovery_replication_policy_id            = azurerm_site_recovery_replication_policy.policy.id<br />}</p><p>resource \"azurerm_site_recovery_network_mapping\" \"network-mapping\" {<br />  name                        = \"network-mapping\"<br />  resource_group_name         = azurerm_resource_group.secondary.name<br />  recovery_vault_name         = azurerm_recovery_services_vault.vault.name<br />  source_recovery_fabric_name = azurerm_site_recovery_fabric.primary.name<br />  target_recovery_fabric_name = azurerm_site_recovery_fabric.secondary.name<br />  source_network_id           = azurerm_virtual_network.primary.id<br />  target_network_id           = azurerm_virtual_network.secondary.id<br />}</p><p>resource \"azurerm_storage_account\" \"primary\" {<br />  name                     = \"primaryrecoverycache\"<br />  location                 = azurerm_resource_group.primary.location<br />  resource_group_name      = azurerm_resource_group.primary.name<br />  account_tier             = \"Standard\"<br />  account_replication_type = \"LRS\"<br />}</p><p>resource \"azurerm_virtual_network\" \"primary\" {<br />  name                = \"network1\"<br />  resource_group_name = azurerm_resource_group.primary.name<br />  address_space       = [\"192.168.1.0/24\"]<br />  location            = azurerm_resource_group.primary.location<br />}</p><p>resource \"azurerm_virtual_network\" \"secondary\" {<br />  name                = \"network2\"<br />  resource_group_name = azurerm_resource_group.secondary.name<br />  address_space       = [\"192.168.2.0/24\"]<br />  location            = azurerm_resource_group.secondary.location<br />}</p><p>resource \"azurerm_subnet\" \"primary\" {<br />  name                 = \"network1-subnet\"<br />  resource_group_name  = azurerm_resource_group.primary.name<br />  virtual_network_name = azurerm_virtual_network.primary.name<br />  address_prefixes     = [\"192.168.1.0/24\"]<br />}</p><p>resource \"azurerm_subnet\" \"secondary\" {<br />  name                 = \"network2-subnet\"<br />  resource_group_name  = azurerm_resource_group.secondary.name<br />  virtual_network_name = azurerm_virtual_network.secondary.name<br />  address_prefixes     = [\"192.168.2.0/24\"]<br />}</p><p>resource \"azurerm_public_ip\" \"primary\" {<br />  name                = \"vm-public-ip-primary\"<br />  allocation_method   = \"Static\"<br />  location            = azurerm_resource_group.primary.location<br />  resource_group_name = azurerm_resource_group.primary.name<br />  sku                 = \"Basic\"<br />}</p><p>resource \"azurerm_public_ip\" \"secondary\" {<br />  name                = \"vm-public-ip-secondary\"<br />  allocation_method   = \"Static\"<br />  location            = azurerm_resource_group.secondary.location<br />  resource_group_name = azurerm_resource_group.secondary.name<br />  sku                 = \"Basic\"<br />}</p><p>resource \"azurerm_network_interface\" \"vm\" {<br />  name                = \"vm-nic\"<br />  location            = azurerm_resource_group.primary.location<br />  resource_group_name = azurerm_resource_group.primary.name</p><p>ip_configuration {<br />    name                          = \"vm\"<br />    subnet_id                     = azurerm_subnet.primary.id<br />    private_ip_address_allocation = \"Dynamic\"<br />    public_ip_address_id          = azurerm_public_ip.primary.id<br />  }<br />}</p><p>resource \"azurerm_site_recovery_replicated_vm\" \"vm-replication\" {<br />  name                                      = \"vm-replication\"<br />  resource_group_name                       = azurerm_resource_group.secondary.name<br />  recovery_vault_name                       = azurerm_recovery_services_vault.vault.name<br />  source_recovery_fabric_name               = azurerm_site_recovery_fabric.primary.name<br />  source_vm_id                              = azurerm_virtual_machine.vm.id<br />  recovery_replication_policy_id            = azurerm_site_recovery_replication_policy.policy.id<br />  source_recovery_protection_container_name = azurerm_site_recovery_protection_container.primary.name</p><p>target_resource_group_id                = azurerm_resource_group.secondary.id<br />  target_recovery_fabric_id               = azurerm_site_recovery_fabric.secondary.id<br />  target_recovery_protection_container_id = azurerm_site_recovery_protection_container.secondary.id</p><p>managed_disk {<br />    disk_id                    = azurerm_virtual_machine.vm.storage_os_disk[0].managed_disk_id<br />    staging_storage_account_id = azurerm_storage_account.primary.id<br />    target_resource_group_id   = azurerm_resource_group.secondary.id<br />    target_disk_type           = \"Premium_LRS\"<br />    target_replica_disk_type   = \"Premium_LRS\"<br />  }</p><p>network_interface {<br />    source_network_interface_id   = azurerm_network_interface.vm.id<br />    target_subnet_name            = azurerm_subnet.secondary.name<br />    recovery_public_ip_address_id = azurerm_public_ip.secondary.id<br />  }</p><p>depends_on = [<br />    azurerm_site_recovery_protection_container_mapping.container-mapping,<br />    azurerm_site_recovery_network_mapping.network-mapping,<br />  ]<br />}<br /></p>", "argument-reference": "<h2 id=\"argument-reference\">Argument Reference</h2><p>The following arguments are supported:</p><ul><li><p><code>name</code> - (Required) The name of the replication for the replicated VM. Changing this forces a new resource to be created.</p></li><li><p><code>resource_group_name</code> - (Required) Name of the resource group where the vault that should be updated is located. Changing this forces a new resource to be created.</p></li><li><p><code>recovery_vault_name</code> - (Required) The name of the vault that should be updated. Changing this forces a new resource to be created.</p></li><li><p><code>recovery_replication_policy_id</code> - (Required) Id of the policy to use for this replicated vm. Changing this forces a new resource to be created.</p></li><li><p><code>source_recovery_fabric_name</code> - (Required) Name of fabric that should contain this replication. Changing this forces a new resource to be created.</p></li><li><p><code>source_vm_id</code> - (Required) Id of the VM to replicate Changing this forces a new resource to be created.</p></li><li><p><code>source_recovery_protection_container_name</code> - (Required) Name of the protection container to use. Changing this forces a new resource to be created.</p></li><li><p><code>target_resource_group_id</code> - (Required) Id of resource group where the VM should be created when a failover is done. Changing this forces a new resource to be created.</p></li><li><p><code>target_recovery_fabric_id</code> - (Required) Id of fabric where the VM replication should be handled when a failover is done. Changing this forces a new resource to be created.</p></li><li><p><code>target_recovery_protection_container_id</code> - (Required) Id of protection container where the VM replication should be created when a failover is done. Changing this forces a new resource to be created.</p></li><li><p><code>target_availability_set_id</code> - (Optional) Id of availability set that the new VM should belong to when a failover is done.</p></li><li><p><code>target_zone</code> - (Optional) Specifies the Availability Zone where the Failover VM should exist. Changing this forces a new resource to be created.</p></li><li><p><code>managed_disk</code> - (Optional) One or more <code>managed_disk</code> block as defined below. Changing this forces a new resource to be created.</p></li><li><p><code>unmanaged_disk</code> - (Optional) One or more <code>unmanaged_disk</code> block. Changing this forces a new resource to be created.</p></li><li><p><code>target_edge_zone</code> - (Optional) Specifies the Edge Zone within the Azure Region where this Managed Kubernetes Cluster should exist. Changing this forces a new resource to be created.</p></li><li><p><code>target_proximity_placement_group_id</code> - (Optional) Id of Proximity Placement Group the new VM should belong to when a failover is done.</p></li><li><p><code>target_boot_diagnostic_storage_account_id</code> - (Optional) Id of the storage account which the new VM should used for boot diagnostic when a failover is done.</p></li><li><p><code>target_capacity_reservation_group_id</code> - (Optional) Id of the Capacity reservation group where the new VM should belong to when a failover is done.</p></li><li><p><code>target_virtual_machine_scale_set_id</code> - (Optional) Id of the Virtual Machine Scale Set which the new Vm should belong to when a failover is done.</p></li><li><p><code>target_network_id</code> - (Optional) Network to use when a failover is done (recommended to set if any network_interface is configured for failover).</p></li><li><p><code>test_network_id</code> - (Optional) Network to use when a test failover is done.</p></li><li><p><code>network_interface</code> - (Optional) One or more <code>network_interface</code> block as defined below.</p></li><li></li><li><code>multi_vm_group_name</code> - (Optional) Name of group in which all machines will replicate together and have shared crash consistent and app-consistent recovery points when failed over.</li></ul><hr /><p>A <code>managed_disk</code> block supports the following:</p><ul><li><p><code>disk_id</code> - (Required) Id of disk that should be replicated. Changing this forces a new resource to be created.</p></li><li><p><code>staging_storage_account_id</code> - (Required) Storage account that should be used for caching. Changing this forces a new resource to be created.</p></li><li><p><code>target_resource_group_id</code> - (Required) Resource group disk should belong to when a failover is done. Changing this forces a new resource to be created.</p></li><li><p><code>target_disk_type</code> - (Required) What type should the disk be when a failover is done. Possible values are <code>Standard_LRS</code>, <code>Premium_LRS</code>, <code>StandardSSD_LRS</code> and <code>UltraSSD_LRS</code>. Changing this forces a new resource to be created.</p></li><li><p><code>target_replica_disk_type</code> - (Required) What type should the disk be that holds the replication data. Possible values are <code>Standard_LRS</code>, <code>Premium_LRS</code>, <code>StandardSSD_LRS</code> and <code>UltraSSD_LRS</code>. Changing this forces a new resource to be created.</p></li><li><p><code>target_disk_encryption_set_id</code> - (Optional) The Disk Encryption Set that the Managed Disk will be associated with. Changing this forces a new resource to be created.</p></li></ul><p>-&gt; <strong>NOTE:</strong> Creating replicated vm with <code>target_disk_encryption_set_id</code> wil take more time (up to 5 hours), please extend the <code>timeout</code> for <code>create</code>. </p><ul><li><code>target_disk_encryption</code> - (Optional) A <code>target_disk_encryption</code> block as defined below.</li></ul><hr /><p>A <code>unmanaged_disk</code> block supports the following:</p><ul><li><p><code>disk_uri</code> - (Required) Id of disk that should be replicated.</p></li><li><p><code>staging_storage_account_id</code> - (Required) Storage account that should be used for caching.</p></li><li><p><code>target_storage_account_id</code> - (Required) Storage account disk should belong to when a failover is done.</p></li></ul><hr /><p>A <code>network_interface</code> block supports the following:</p><ul><li><p><code>source_network_interface_id</code> - (Optional) (Required if the network_interface block is specified) Id source network interface.</p></li><li><p><code>target_static_ip</code> - (Optional) Static IP to assign when a failover is done.</p></li><li><p><code>target_subnet_name</code> - (Optional) Name of the subnet to to use when a failover is done.</p></li><li><p><code>recovery_public_ip_address_id</code> - (Optional) Id of the public IP object to use when a failover is done.</p></li><li><p><code>failover_test_static_ip</code> - (Optional) Static IP to assign when a test failover is done.</p></li><li><p><code>failover_test_subnet_name</code> - (Optional) Name of the subnet to to use when a test failover is done.</p></li><li><p><code>failover_test_public_ip_address_id</code> - (Optional) Id of the public IP object to use when a test failover is done.</p></li></ul><hr /><p>The <code>target_disk_encryption</code> block supports:</p><ul><li><p><code>disk_encryption_key</code> - (Required) A <code>disk_encryption_key</code> block as defined below.</p></li><li><p><code>key_encryption_key</code> - (Optional) A <code>key_encryption_key</code> block as defined below.</p></li></ul><hr /><p>The <code>disk_encryption_key</code> block supports:</p><ul><li><p><code>secret_url</code> - (Required) The URL to the Key Vault Secret used as the Disk Encryption Key that the Managed Disk will be associated with. This can be found as <code>id</code> on the <code>azurerm_key_vault_secret</code> resource. Changing this forces a new resource to be created.</p></li><li><p><code>vault_id</code> - (Required) The ID of the Key Vault. This can be found as <code>id</code> on the <code>azurerm_key_vault</code> resource. Changing this forces a new resource to be created.</p></li></ul><hr /><p>The <code>key_encryption_key</code> block supports:</p><ul><li><p><code>key_url</code> - (Required) The URL to the Key Vault Key used as the Key Encryption Key that the Managed Disk will be associated with. This can be found as <code>id</code> on the <code>azurerm_key_vault_key</code> resource. Changing this forces a new resource to be created.</p></li><li><p><code>vault_id</code> - (Required) The ID of the Key Vault. This can be found as <code>id</code> on the <code>azurerm_key_vault</code> resource. Changing this forces a new resource to be created.</p></li></ul>", "attributes-reference": "<h2 id=\"attributes-reference\">Attributes Reference</h2><p>In addition to the arguments above, the following attributes are exported:</p><ul><li><code>id</code> - The ID of the Site Recovery Replicated VM.</li></ul>", "timeouts": "<h2 id=\"timeouts\">Timeouts</h2><p>The <code>timeouts</code> block allows you to specify <a href=\"https://www.terraform.io/language/resources/syntax#operation-timeouts\">timeouts</a> for certain actions:</p><ul><li><code>create</code> - (Defaults to 3 hours) Used when creating the Site Recovery Replicated VM.</li><li><code>update</code> - (Defaults to 80 minutes) Used when updating the Site Recovery Replicated VM.</li><li><code>read</code> - (Defaults to 5 minutes) Used when retrieving the Site Recovery Replicated VM.</li><li><code>delete</code> - (Defaults to 80 minutes) Used when deleting the Site Recovery Replicated VM.</li></ul>", "import": "<h2 id=\"import\">Import</h2><p>Site Recovery Replicated VM's can be imported using the <code>resource id</code>, e.g.</p><p><code>shellterraform import azurerm_site_recovery_replicated_vm.vmreplication /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resource-group-name/providers/Microsoft.RecoveryServices/vaults/recovery-vault-name/replicationFabrics/fabric-name/replicationProtectionContainers/protection-container-name/replicationProtectedItems/vm-replication-name</code></p>", "description": "<h1 id=\"azurerm_site_recovery_replicated_vm\">azurerm_site_recovery_replicated_vm</h1><p>Manages a VM replicated using Azure Site Recovery (Azure to Azure only). A replicated VM keeps a copiously updated image of the VM in another region in order to be able to start the VM in that region in case of a disaster.</p>"}