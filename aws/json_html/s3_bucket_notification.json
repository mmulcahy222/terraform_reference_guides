{"resource-aws-s3-bucket-notification": "<h1 id=\"resource-aws_s3_bucket_notification\">Resource: aws_s3_bucket_notification</h1><p>Manages a S3 Bucket Notification Configuration. For additional information, see the <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/dev/NotificationHowTo.html\">Configuring S3 Event Notifications section in the Amazon S3 Developer Guide</a>.</p><p>~&gt; <strong>NOTE:</strong> S3 Buckets only support a single notification configuration. Declaring multiple <code>aws_s3_bucket_notification</code> resources to the same S3 Bucket will cause a perpetual difference in configuration. See the example \"Trigger multiple Lambda functions\" for an option.</p>", "example-usage": "<h2 id=\"example-usage\">Example Usage</h2><h3 id=\"add-notification-configuration-to-sns-topic\">Add notification configuration to SNS Topic</h3><br /><p>terraform<br />data \"aws_iam_policy_document\" \"topic\" {<br />  statement {<br />    effect = \"Allow\"</p><br /><pre><code>principals {<br />  type        = \"Service\"<br />  identifiers = [\"s3.amazonaws.com\"]<br />}<br /><br />actions   = [\"SNS:Publish\"]<br />resources = [\"arn:aws:sns:*:*:s3-event-notification-topic\"]<br /><br />condition {<br />  test     = \"ArnLike\"<br />  variable = \"aws:SourceArn\"<br />  values   = [aws_s3_bucket.bucket.arn]<br />}<br /></code></pre><br /><p>}<br />}<br />resource \"aws_sns_topic\" \"topic\" {<br />  name   = \"s3-event-notification-topic\"<br />  policy = data.aws_iam_policy_document.topic.json<br />}</p><br /><p>resource \"aws_s3_bucket\" \"bucket\" {<br />  bucket = \"your-bucket-name\"<br />}</p><br /><p>resource \"aws_s3_bucket_notification\" \"bucket_notification\" {<br />  bucket = aws_s3_bucket.bucket.id</p><br /><p>topic {<br />    topic_arn     = aws_sns_topic.topic.arn<br />    events        = [\"s3:ObjectCreated:*\"]<br />    filter_suffix = \".log\"<br />  }<br />}</p><br /><h3 id=\"add-notification-configuration-to-sqs-queue\">Add notification configuration to SQS Queue</h3><br /><p>terraform<br />data \"aws_iam_policy_document\" \"queue\" {<br />  statement {<br />    effect = \"Allow\"</p><br /><pre><code>principals {<br />  type        = \"*\"<br />  identifiers = [\"*\"]<br />}<br /><br />actions   = [\"sqs:SendMessage\"]<br />resources = [\"arn:aws:sqs:*:*:s3-event-notification-queue\"]<br /><br />condition {<br />  test     = \"ArnEquals\"<br />  variable = \"aws:SourceArn\"<br />  values   = [aws_s3_bucket.bucket.arn]<br />}<br /></code></pre><br /><p>}<br />}</p><br /><p>resource \"aws_sqs_queue\" \"queue\" {<br />  name   = \"s3-event-notification-queue\"<br />  policy = data.aws_iam_policy_document.queue.json<br />}</p><br /><p>resource \"aws_s3_bucket\" \"bucket\" {<br />  bucket = \"your-bucket-name\"<br />}</p><br /><p>resource \"aws_s3_bucket_notification\" \"bucket_notification\" {<br />  bucket = aws_s3_bucket.bucket.id</p><br /><p>queue {<br />    queue_arn     = aws_sqs_queue.queue.arn<br />    events        = [\"s3:ObjectCreated:*\"]<br />    filter_suffix = \".log\"<br />  }<br />}</p><br /><h3 id=\"add-notification-configuration-to-lambda-function\">Add notification configuration to Lambda Function</h3><br /><p>terraform<br />data \"aws_iam_policy_document\" \"assume_role\" {<br />  statement {<br />    effect = \"Allow\"</p><br /><pre><code>principals {<br />  type        = \"Service\"<br />  identifiers = [\"lambda.amazonaws.com\"]<br />}<br /><br />actions = [\"sts:AssumeRole\"]<br /></code></pre><br /><p>}<br />}</p><br /><p>resource \"aws_iam_role\" \"iam_for_lambda\" {<br />  name               = \"iam_for_lambda\"<br />  assume_role_policy = data.aws_iam_policy_document.assume_role.json<br />}</p><br /><p>resource \"aws_lambda_permission\" \"allow_bucket\" {<br />  statement_id  = \"AllowExecutionFromS3Bucket\"<br />  action        = \"lambda:InvokeFunction\"<br />  function_name = aws_lambda_function.func.arn<br />  principal     = \"s3.amazonaws.com\"<br />  source_arn    = aws_s3_bucket.bucket.arn<br />}</p><br /><p>resource \"aws_lambda_function\" \"func\" {<br />  filename      = \"your-function.zip\"<br />  function_name = \"example_lambda_name\"<br />  role          = aws_iam_role.iam_for_lambda.arn<br />  handler       = \"exports.example\"<br />  runtime       = \"go1.x\"<br />}</p><br /><p>resource \"aws_s3_bucket\" \"bucket\" {<br />  bucket = \"your-bucket-name\"<br />}</p><br /><p>resource \"aws_s3_bucket_notification\" \"bucket_notification\" {<br />  bucket = aws_s3_bucket.bucket.id</p><br /><p>lambda_function {<br />    lambda_function_arn = aws_lambda_function.func.arn<br />    events              = [\"s3:ObjectCreated:*\"]<br />    filter_prefix       = \"AWSLogs/\"<br />    filter_suffix       = \".log\"<br />  }</p><br /><p>depends_on = [aws_lambda_permission.allow_bucket]<br />}</p><br /><h3 id=\"trigger-multiple-lambda-functions\">Trigger multiple Lambda functions</h3><br /><p>terraform<br />data \"aws_iam_policy_document\" \"assume_role\" {<br />  effect = \"Allow\"</p><br /><p>principals {<br />    type        = \"Service\"<br />    identifiers = [\"lambda.amazonaws.com\"]<br />  }</p><br /><p>actions = [\"sts:AssumeRole\"]<br />}</p><br /><p>resource \"aws_iam_role\" \"iam_for_lambda\" {<br />  name               = \"iam_for_lambda\"<br />  assume_role_policy = data.aws_iam_policy_document.assume_role.json<br />}</p><br /><p>resource \"aws_lambda_permission\" \"allow_bucket1\" {<br />  statement_id  = \"AllowExecutionFromS3Bucket1\"<br />  action        = \"lambda:InvokeFunction\"<br />  function_name = aws_lambda_function.func1.arn<br />  principal     = \"s3.amazonaws.com\"<br />  source_arn    = aws_s3_bucket.bucket.arn<br />}</p><br /><p>resource \"aws_lambda_function\" \"func1\" {<br />  filename      = \"your-function1.zip\"<br />  function_name = \"example_lambda_name1\"<br />  role          = aws_iam_role.iam_for_lambda.arn<br />  handler       = \"exports.example\"<br />  runtime       = \"go1.x\"<br />}</p><br /><p>resource \"aws_lambda_permission\" \"allow_bucket2\" {<br />  statement_id  = \"AllowExecutionFromS3Bucket2\"<br />  action        = \"lambda:InvokeFunction\"<br />  function_name = aws_lambda_function.func2.arn<br />  principal     = \"s3.amazonaws.com\"<br />  source_arn    = aws_s3_bucket.bucket.arn<br />}</p><br /><p>resource \"aws_lambda_function\" \"func2\" {<br />  filename      = \"your-function2.zip\"<br />  function_name = \"example_lambda_name2\"<br />  role          = aws_iam_role.iam_for_lambda.arn<br />  handler       = \"exports.example\"<br />}</p><br /><p>resource \"aws_s3_bucket\" \"bucket\" {<br />  bucket = \"your-bucket-name\"<br />}</p><br /><p>resource \"aws_s3_bucket_notification\" \"bucket_notification\" {<br />  bucket = aws_s3_bucket.bucket.id</p><br /><p>lambda_function {<br />    lambda_function_arn = aws_lambda_function.func1.arn<br />    events              = [\"s3:ObjectCreated:*\"]<br />    filter_prefix       = \"AWSLogs/\"<br />    filter_suffix       = \".log\"<br />  }</p><br /><p>lambda_function {<br />    lambda_function_arn = aws_lambda_function.func2.arn<br />    events              = [\"s3:ObjectCreated:*\"]<br />    filter_prefix       = \"OtherLogs/\"<br />    filter_suffix       = \".log\"<br />  }</p><br /><p>depends_on = [<br />    aws_lambda_permission.allow_bucket1,<br />    aws_lambda_permission.allow_bucket2,<br />  ]<br />}</p><br /><h3 id=\"add-multiple-notification-configurations-to-sqs-queue\">Add multiple notification configurations to SQS Queue</h3><br /><p>terraform<br />data \"aws_iam_policy_document\" \"queue\" {<br />  statement {<br />    effect = \"Allow\"</p><br /><pre><code>principals {<br />  type        = \"*\"<br />  identifiers = [\"*\"]<br />}<br /><br />actions   = [\"sqs:SendMessage\"]<br />resources = [\"arn:aws:sqs:*:*:s3-event-notification-queue\"]<br /><br />condition {<br />  test     = \"ArnEquals\"<br />  variable = \"aws:SourceArn\"<br />  values   = [aws_s3_bucket.bucket.arn]<br />}<br /></code></pre><br /><p>}<br />}</p><br /><p>resource \"aws_sqs_queue\" \"queue\" {<br />  name   = \"s3-event-notification-queue\"<br />  policy = data.aws_iam_policy_document.queue.json<br />}</p><br /><p>resource \"aws_s3_bucket\" \"bucket\" {<br />  bucket = \"your-bucket-name\"<br />}</p><br /><p>resource \"aws_s3_bucket_notification\" \"bucket_notification\" {<br />  bucket = aws_s3_bucket.bucket.id</p><br /><p>queue {<br />    id            = \"image-upload-event\"<br />    queue_arn     = aws_sqs_queue.queue.arn<br />    events        = [\"s3:ObjectCreated:*\"]<br />    filter_prefix = \"images/\"<br />  }</p><br /><p>queue {<br />    id            = \"video-upload-event\"<br />    queue_arn     = aws_sqs_queue.queue.arn<br />    events        = [\"s3:ObjectCreated:*\"]<br />    filter_prefix = \"videos/\"<br />  }<br />}</p><br /><p>For Terraform's <a href=\"https://www.terraform.io/docs/configuration/syntax.html\">JSON syntax</a>, use an array instead of defining the <code>queue</code> key twice.</p><br /><p>json<br />{<br />    \"bucket\": \"${aws_s3_bucket.bucket.id}\",<br />    \"queue\": [<br />        {<br />            \"id\": \"image-upload-event\",<br />            \"queue_arn\": \"${aws_sqs_queue.queue.arn}\",<br />            \"events\": [\"s3:ObjectCreated:<em>\"],<br />            \"filter_prefix\": \"images/\"<br />        },<br />        {<br />            \"id\": \"video-upload-event\",<br />            \"queue_arn\": \"${aws_sqs_queue.queue.arn}\",<br />            \"events\": [\"s3:ObjectCreated:</em>\"],<br />            \"filter_prefix\": \"videos/\"<br />        }<br />    ]<br />}</p><br /><h3 id=\"emit-events-to-eventbridge\">Emit events to EventBridge</h3><br /><p>terraform<br />resource \"aws_s3_bucket\" \"bucket\" {<br />  bucket = \"your-bucket-name\"<br />}</p><br /><p>resource \"aws_s3_bucket_notification\" \"bucket_notification\" {<br />  bucket      = aws_s3_bucket.bucket.id<br />  eventbridge = true<br />}</p><br />", "argument-reference": "<h2 id=\"argument-reference\">Argument Reference</h2><p>The following arguments are required:</p><ul><li><code>bucket</code> - (Required) Name of the bucket for notification configuration.</li></ul><p>The following arguments are optional:</p><ul><li><code>eventbridge</code> - (Optional) Whether to enable Amazon EventBridge notifications. Defaults to <code>false</code>.</li><li><code>lambda_function</code> - (Optional, Multiple) Used to configure notifications to a Lambda Function. See below.</li><li><code>queue</code> - (Optional) Notification configuration to SQS Queue. See below.</li><li><code>topic</code> - (Optional) Notification configuration to SNS Topic. See below.</li></ul><h3 id=\"lambda_function\"><code>lambda_function</code></h3><ul><li><code>events</code> - (Required) <a href=\"http://docs.aws.amazon.com/AmazonS3/latest/dev/NotificationHowTo.html#notification-how-to-event-types-and-destinations\">Event</a> for which to send notifications.</li><li><code>filter_prefix</code> - (Optional) Object key name prefix.</li><li><code>filter_suffix</code> - (Optional) Object key name suffix.</li><li><code>id</code> - (Optional) Unique identifier for each of the notification configurations.</li><li><code>lambda_function_arn</code> - (Required) Lambda function ARN.</li></ul><h3 id=\"queue\"><code>queue</code></h3><ul><li><code>events</code> - (Required) Specifies <a href=\"http://docs.aws.amazon.com/AmazonS3/latest/dev/NotificationHowTo.html#notification-how-to-event-types-and-destinations\">event</a> for which to send notifications.</li><li><code>filter_prefix</code> - (Optional) Object key name prefix.</li><li><code>filter_suffix</code> - (Optional) Object key name suffix.</li><li><code>id</code> - (Optional) Unique identifier for each of the notification configurations.</li><li><code>queue_arn</code> - (Required) SQS queue ARN.</li></ul><h3 id=\"topic\"><code>topic</code></h3><ul><li><code>events</code> - (Required) <a href=\"http://docs.aws.amazon.com/AmazonS3/latest/dev/NotificationHowTo.html#notification-how-to-event-types-and-destinations\">Event</a> for which to send notifications.</li><li><code>filter_prefix</code> - (Optional) Object key name prefix.</li><li><code>filter_suffix</code> - (Optional) Object key name suffix.</li><li><code>id</code> - (Optional) Unique identifier for each of the notification configurations.</li><li><code>topic_arn</code> - (Required) SNS topic ARN.</li></ul>", "attribute-reference": "<h2 id=\"attribute-reference\">Attribute Reference</h2><p>This resource exports no additional attributes.</p>", "import": "<h2 id=\"import\">Import</h2><p>In Terraform v1.5.0 and later, use an <a href=\"https://developer.hashicorp.com/terraform/language/import\"><code>import</code> block</a> to import S3 bucket notification using the <code>bucket</code>. For example:</p><p>terraform<br />import {<br />  to = aws_s3_bucket_notification.bucket_notification<br />  id = \"bucket-name\"<br />}</p><p>Using <code>terraform import</code>, import S3 bucket notification using the <code>bucket</code>. For example:</p><p>console<br />% terraform import aws_s3_bucket_notification.bucket_notification bucket-name</p>", "description": "<h1 id=\"resource-aws_s3_bucket_notification\">Resource: aws_s3_bucket_notification</h1><p>Manages a S3 Bucket Notification Configuration. For additional information, see the <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/dev/NotificationHowTo.html\">Configuring S3 Event Notifications section in the Amazon S3 Developer Guide</a>.</p><p>~&gt; <strong>NOTE:</strong> S3 Buckets only support a single notification configuration. Declaring multiple <code>aws_s3_bucket_notification</code> resources to the same S3 Bucket will cause a perpetual difference in configuration. See the example \"Trigger multiple Lambda functions\" for an option.</p>"}