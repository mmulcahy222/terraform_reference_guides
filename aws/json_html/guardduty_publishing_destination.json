{"resource-aws-guardduty-publishing-destination": "<h1 id=\"resource-aws_guardduty_publishing_destination\">Resource: aws_guardduty_publishing_destination</h1><p>Provides a resource to manage a GuardDuty PublishingDestination. Requires an existing GuardDuty Detector.</p>", "example-usage": "<h2 id=\"example-usage\">Example Usage</h2><p>terraform<br />data \"aws_caller_identity\" \"current\" {}</p><br /><p>data \"aws_region\" \"current\" {}</p><br /><p>data \"aws_iam_policy_document\" \"bucket_pol\" {<br />  statement {<br />    sid = \"Allow PutObject\"<br />    actions = [<br />      \"s3:PutObject\"<br />    ]</p><br /><pre><code>resources = [<br />  \"${aws_s3_bucket.gd_bucket.arn}/*\"<br />]<br /><br />principals {<br />  type        = \"Service\"<br />  identifiers = [\"guardduty.amazonaws.com\"]<br />}<br /></code></pre><br /><p>}</p><br /><p>statement {<br />    sid = \"Allow GetBucketLocation\"<br />    actions = [<br />      \"s3:GetBucketLocation\"<br />    ]</p><br /><pre><code>resources = [<br />  aws_s3_bucket.gd_bucket.arn<br />]<br /><br />principals {<br />  type        = \"Service\"<br />  identifiers = [\"guardduty.amazonaws.com\"]<br />}<br /></code></pre><br /><p>}<br />}</p><br /><p>data \"aws_iam_policy_document\" \"kms_pol\" {</p><br /><p>statement {<br />    sid = \"Allow GuardDuty to encrypt findings\"<br />    actions = [<br />      \"kms:GenerateDataKey\"<br />    ]</p><br /><pre><code>resources = [<br />  \"arn:aws:kms:${data.aws_region.current.name}:${data.aws_caller_identity.current.account_id}:key/*\"<br />]<br /><br />principals {<br />  type        = \"Service\"<br />  identifiers = [\"guardduty.amazonaws.com\"]<br />}<br /></code></pre><br /><p>}</p><br /><p>statement {<br />    sid = \"Allow all users to modify/delete key (test only)\"<br />    actions = [<br />      \"kms:*\"<br />    ]</p><br /><pre><code>resources = [<br />  \"arn:aws:kms:${data.aws_region.current.name}:${data.aws_caller_identity.current.account_id}:key/*\"<br />]<br /><br />principals {<br />  type        = \"AWS\"<br />  identifiers = [\"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\"]<br />}<br /></code></pre><br /><p>}</p><br /><p>}</p><br /><p>resource \"aws_guardduty_detector\" \"test_gd\" {<br />  enable = true<br />}</p><br /><p>resource \"aws_s3_bucket\" \"gd_bucket\" {<br />  bucket        = \"example\"<br />  force_destroy = true<br />}</p><br /><p>resource \"aws_s3_bucket_acl\" \"gd_bucket_acl\" {<br />  bucket = aws_s3_bucket.gd_bucket.id<br />  acl    = \"private\"<br />}</p><br /><p>resource \"aws_s3_bucket_policy\" \"gd_bucket_policy\" {<br />  bucket = aws_s3_bucket.gd_bucket.id<br />  policy = data.aws_iam_policy_document.bucket_pol.json<br />}</p><br /><p>resource \"aws_kms_key\" \"gd_key\" {<br />  description             = \"Temporary key for AccTest of TF\"<br />  deletion_window_in_days = 7<br />  policy                  = data.aws_iam_policy_document.kms_pol.json<br />}</p><br /><p>resource \"aws_guardduty_publishing_destination\" \"test\" {<br />  detector_id     = aws_guardduty_detector.test_gd.id<br />  destination_arn = aws_s3_bucket.gd_bucket.arn<br />  kms_key_arn     = aws_kms_key.gd_key.arn</p><br /><p>depends_on = [<br />    aws_s3_bucket_policy.gd_bucket_policy,<br />  ]<br />}</p><br /><p>~&gt; <strong>Note:</strong> Please do not use this simple example for Bucket-Policy and KMS Key Policy in a production environment. It is much too open for such a use-case. Refer to the AWS documentation here: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_exportfindings.html</p><br />", "argument-reference": "<h2 id=\"argument-reference\">Argument Reference</h2><p>This resource supports the following arguments:</p><ul><li><code>detector_id</code> - (Required) The detector ID of the GuardDuty.</li><li><code>destination_arn</code> - (Required) The bucket arn and prefix under which the findings get exported. Bucket-ARN is required, the prefix is optional and will be <code>AWSLogs/[Account-ID]/GuardDuty/[Region]/</code> if not provided</li><li><code>kms_key_arn</code> - (Required) The ARN of the KMS key used to encrypt GuardDuty findings. GuardDuty enforces this to be encrypted.</li><li><code>destination_type</code>- (Optional) Currently there is only \"S3\" available as destination type which is also the default value</li></ul><p>~&gt; <strong>Note:</strong> In case of missing permissions (S3 Bucket Policy <em>or</em> KMS Key permissions) the resource will fail to create. If the permissions are changed after resource creation, this can be asked from the AWS API via the \"DescribePublishingDestination\" call (https://docs.aws.amazon.com/cli/latest/reference/guardduty/describe-publishing-destination.html).</p>", "attribute-reference": "<h2 id=\"attribute-reference\">Attribute Reference</h2><p>This resource exports the following attributes in addition to the arguments above:</p><ul><li><code>id</code> - The ID of the GuardDuty PublishingDestination and the detector ID. Format: <code>&lt;DetectorID&gt;:&lt;PublishingDestinationID&gt;</code></li></ul>", "import": "<h2 id=\"import\">Import</h2><p>In Terraform v1.5.0 and later, use an <a href=\"https://developer.hashicorp.com/terraform/language/import\"><code>import</code> block</a> to import GuardDuty PublishingDestination using the master GuardDuty detector ID and PublishingDestinationID. For example:</p><p>terraform<br />import {<br />  to = aws_guardduty_publishing_destination.test<br />  id = \"a4b86f26fa42e7e7cf0d1c333ea77777:a4b86f27a0e464e4a7e0516d242f1234\"<br />}</p><p>Using <code>terraform import</code>, import GuardDuty PublishingDestination using the master GuardDuty detector ID and PublishingDestinationID. For example:</p><p>console<br />% terraform import aws_guardduty_publishing_destination.test a4b86f26fa42e7e7cf0d1c333ea77777:a4b86f27a0e464e4a7e0516d242f1234</p>", "description": "<h1 id=\"resource-aws_guardduty_publishing_destination\">Resource: aws_guardduty_publishing_destination</h1><p>Provides a resource to manage a GuardDuty PublishingDestination. Requires an existing GuardDuty Detector.</p>"}